@{
    Layout = null;
}
@using IMS.Model.ViewModel
@model SummarizeViewModel
<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Summarize</title>
    <link href="~/Content/bootstrap/css/bootstrap.css" rel="stylesheet" />
    <link href="~/Content/bootstrap/css/bootstrap-datetimepicker.css" rel="stylesheet" />
    <script src="~/Content/bootstrap/js/jquery-1.11.0.min.js"></script>
    <script src="~/Content/bootstrap/js/bootstrap-datetimepicker.min.js"></script>
    <script src="~/Content/bootstrap/js/bootstrap-datetimepicker.zh-CN.js"></script>
    <style type="text/css">
        .tg {
            border-collapse: collapse;
            border-spacing: 0;
            border-color: #999;
            width: 850px;
            padding: 1px;
            margin: 1px;
            font-size: 12px;
        }

            .tg td {
                font-family: Arial, sans-serif;
                font-size: 14px;
                padding: 10px 5px;
                border-style: solid;
                border-width: 1px;
                overflow: hidden;
                word-break: normal;
                border-color: #999;
                color: #444;
                background-color: #F7FDFA;
            }

            .tg th {
                font-family: Arial, sans-serif;
                font-size: 14px;
                font-weight: normal;
                padding: 10px 5px;
                border-style: solid;
                border-width: 1px;
                overflow: hidden;
                word-break: normal;
                border-color: #999;
                color: #fff;
                background-color: #26ADE4;
            }

            .tg .tg-pmhw {
                font-size: 10px;
                background-color: #c0c0c0;
                color: #000000;
                text-align: right;
                vertical-align: top;
            }

            .tg .tg-l9q5 {
                background-color: #c0c0c0;
                color: #000000;
                vertical-align: top;
            }

            .tg .tg-2de4 {
                background-color: #c0c0c0;
                color: #000000;
                text-align: right;
                vertical-align: top;
                width: 150px;
            }

            .tg .tg-pxng {
                background-color: #ffffff;
                color: #000000;
                vertical-align: top;
                width: 180px;
            }

            .tg .tg-fefd {
                color: #000000;
                vertical-align: top;
            }
    </style>
</head>
<body>
    <input type="hidden" id="sum_appid" value="@Model.ApplicationVM.Id" />
    <div class="tg-wrap">
        <table class="tg">
            <tr>
                <th class="tg-2de4">故障设备</th>
                <th class="tg-pxng">@Model.ApplicationVM.DeviceShortName</th>
                <th class="tg-pmhw">发生时间</th>
                <th class="tg-pxng">@Model.ApplicationVM.BeginTime</th>
                <th class="tg-2de4">报修时间</th>
                <th class="tg-pxng">@Model.ApplicationVM.ApplicationTime</th>
            </tr>
            <tr>
                <td class="tg-2de4">故障部位</td>
                <td class="tg-fefd" colspan="5">@Model.ApplicationVM.FullLocation</td>
            </tr>
            <tr>
                <td class="tg-2de4">故障描述</td>
                <td class="tg-pxng" colspan="5">@Model.ApplicationVM.FailureDescription</td>
            </tr>
            <tr>
                <td class="tg-2de4">故障现象</td>
                <td class="tg-fefd" colspan="5">@Model.ApplicationVM.FailureAppearance</td>
            </tr>
            <tr>
                <td class="tg-2de4">审核人</td>
                <td class="tg-fefd">@Model.Dispatcher</td>
                <td class="tg-2de4">审核时间</td>
                <td class="tg-fefd">@Model.DispatchTime</td>
                <td class="tg-2de4">审核结果</td>
                <td class="tg-fefd"></td>
            </tr>
            <tr>
                <td class="tg-2de4">维修（诊断）工程师</td>
                <td class="tg-fefd">@Model.Engineer</td>
                <td class="tg-2de4">指示事项</td>
                <td class="tg-fefd" colspan="3">@Model.Instruction</td>
            </tr>
            <tr>
                <td class="tg-2de4">维修开始时间</td>
                <td class="tg-fefd">
                    <div class='input-group date' id='div_fssj'>
                        <input type='text' id="sum_begintime" data-date-format="yyyy-mm-dd hh:ii" />
                        <span class="input-group-addon">
                            <span class="glyphicon glyphicon-calendar"></span>
                        </span>
                    </div>
                </td>
                <td class="tg-2de4">维修用时</td>
                <td class="tg-fefd">
                    <input type="text" id="sum_timecost" />
                </td>
                <td class="tg-2de4">故障描述</td>
                <td class="tg-fefd">
                    <textarea id="sum_description"></textarea>
                </td>
            </tr>
            <tr>
                <td class="tg-2de4">一级故障部位</td>
                <td class="tg-fefd">
                    <select id="firstFailureLocation">
                        <option value="-1">请选择</option>
                    </select>
                </td>
                <td class="tg-2de4">二级故障部位</td>
                <td class="tg-fefd">
                    <select id="secondFailureLocation">
                        <option value="-1">请选择</option>
                    </select>
                </td>
                <td class="tg-l9q5">三级故障部位</td>
                <td class="tg-fefd">
                    <select id="thirdFailureLocation">
                        <option value="-1">请选择</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td class="tg-2de4">故障现象</td>
                <td class="tg-pxng" colspan="5"><textarea id="sum_appearance">@Model.ApplicationVM.FailureAppearance</textarea></td>
            </tr>
            <tr>
                <td class="tg-2de4" rowspan="2">维修步骤</td>
                <td class="tg-fefd" colspan="5" rowspan="2"><textarea id="sum_steps">@Model.SelfRepairVM.Steps</textarea> </td>
            </tr>
            <tr></tr>
            <tr>
                <td class="tg-2de4">维修工具</td>
                <td class="tg-fefd" colspan="3"><textarea id="sum_tools">@Model.SelfRepairVM.Tools</textarea></td>
                <td class="tg-2de4">备件信息</td>
                <td class="tg-fefd" colspan="3"><textarea id="sum_spareparts">@Model.SelfRepairVM.SparePartsInfo</textarea></td>
            </tr>
        </table>
        <input type="button" value="取消" />
        <input type="button" onclick="summarize()" value="提交">
    </div>

    <script type="text/javascript">
        $(function () {
            IniteDropdownList();
            $("#firstFailureLocation").change(function () {
                GetSecondLevelSubSysList();
            });
            $('#div_fssj').datetimepicker({
                //日期格式化，只显示日期
                language: 'zh-CN',     //中文化
                todayBtn: true,
                pickerPosition: "bottom-left"
            });
        });

        function IniteDropdownList() {
            $.post(
            "/Common/GetSubSystemList",
            { lev: 0, parentId: 0 },
            function (data) {
                $.each(data, function (i, item) {
                    $("<option location=" + item["Name"] + "></option>").val(item["Id"]).text(item["Name"]).appendTo($("#firstFailureLocation"));
                });
                $("#firstFailureLocation option[location='@Model.ApplicationVM.FstLevFailureLocation']").attr("Selected", true);
                $.post("/Common/GetSubSystemList", { lev: 1, parentId: $("#firstFailureLocation").val() }, function (data) {
                    $.each(data, function (i, item) {
                        $("<option location=" + item["Name"] + "></option>").val(item["Id"]).text(item["Name"]).appendTo($("#secondFailureLocation"));
                    });
                    $("#secondFailureLocation option[location='@Model.ApplicationVM.SecLevFailureLocation']").attr("Selected", true);
                    $.post("/Common/GetSubSystemList", { lev: 2, parentId: $("#secondFailureLocation").val() }, function (data) {
                        $.each(data, function (i, item) {
                            $("<option location=" + item["Name"] + "></option>").val(item["Id"]).text(item["Name"]).appendTo($("#thirdFailureLocation"));
                        });
                        $("#thirdFailureLocation option[location='@Model.ApplicationVM.ThiLevFailureLocation']").attr("Selected", true);

                    });
                });
            });
        }




        function GetFirstLevelSubSysList() {
            $.post(
                "/Common/GetSubSystemList",
                { lev: 0, parentId: 0 },
                function (data) {
                    $.each(data, function (i, item) {
                        $("<option location=" + item["Name"] + "></option>").val(item["Id"]).text(item["Name"]).appendTo($("#firstFailureLocation"));
                    })
                });

        }
        function GetSecondLevelSubSysList() {
            $("#secondFailureLocation").empty();
            $("<option></option>").val("-1").text("请选择").appendTo($("#secondFailureLocation"));
            $("#thirdFailureLocation").empty();
            $("<option></option>").val("-1").text("请选择").appendTo($("#thirdFailureLocation"));
            $.post(
            "/Common/GetSubSystemList",
            { lev: 1, parentId: $("#firstFailureLocation").val() },
            function (data) {
                $.each(data, function (i, item) {
                    $("<option location=" + item["Name"] + "></option>").val(item["Id"]).text(item["Name"]).appendTo($("#secondFailureLocation"));
                })
            });
            $("#secondFailureLocation").change(function () {
                GetThirdLevelSubSysList();
            });
        }
        function GetThirdLevelSubSysList() {
            $("#thirdFailureLocation").empty();
            $("<option ></option>").val("-1").text("请选择").appendTo($("#thirdFailureLocation"));
            $.post(
            "/Common/GetSubSystemList",
            { lev: 2, parentId: $("#secondFailureLocation").val() },
            function (data) {
                $.each(data, function (i, item) {
                    $("<option location=" + item["Name"] + "></option>").val(item["Id"]).text(item["Name"]).appendTo($("#thirdFailureLocation"));
                })
            });
        }
        function summarize() {
            var beginTime = $("#sum_begintime").val();
            var timeCost = $("#sum_timecost").val();
            var description = $("#sum_description").val();
            var appearance = $("#sum_appearance").val();
            var steps = $("#sum_steps").val();
            var tools = $("#sum_tools").val();
            var partsInfo = $("#sum_spareparts").val();
            var fstLocation = $("#firstFailureLocation option:selected").text();
            var secLocation = $("#secondFailureLocation option:selected").text();
            var thiLocation = $("#thirdFailureLocation option:selected").text();
            $.post("/Repair/Summarize",
                {
                    appID: $("#sum_appid").val(),
                    beginTime: $("#sum_begintime").val(),
                    timeCost: $("#sum_timecost").val(),
                    description: $("#sum_description").val(),
                    appearance: $("#sum_appearance").val(),
                    steps: $("#sum_steps").val(),
                    tools: $("#sum_tools").val(),
                    partsInfo: $("#sum_spareparts").val(),
                    fstLocation: $("#firstFailureLocation option:selected").text(),
                    secLocation: $("#secondFailureLocation option:selected").text(),
                    thiLocation: $("#thirdFailureLocation option:selected").text()
                },
            function (Data) {
                data = $.parseJSON(Data);
                if (data.status == "success") { }
            }
                );
            var a = $("#sum_tools").val();
            alert(a);

        }
    </script>
</body>

</html>
